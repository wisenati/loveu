<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Love U - Registration</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #ff2d75;
        --secondary-color: #ff6b9e;
        --dark-pink: #d60057;
        --light-pink: #ffc0d5;
        --white: #ffffff;
        --text-color: #333333;
        --error-color: #e74c3c;
        --success-color: #2ecc71;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: var(--white);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow-x: hidden;
      }

      .hearts {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }

      .heart {
        position: absolute;
        color: rgba(255, 255, 255, 0.6);
        animation: float 6s ease-in infinite;
        font-size: 1.5rem;
      }

      .container {
        width: 90%;
        max-width: 480px;
        background-color: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        z-index: 2;
        animation: fadeIn 1s ease;
      }

      .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 0 1rem;
      }

      .logo-img {
        width: 50px;
        height: 50px;
        margin-right: 10px;
        animation: pulse 2s infinite;
      }

      .logo-text {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(to right, var(--white), var(--light-pink));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .tabs {
        display: flex;
        margin-bottom: 30px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      }

      .tab {
        flex: 1;
        text-align: center;
        padding: 15px 0;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--white);
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0.6;
        position: relative;
      }

      .tab.active {
        opacity: 1;
      }

      .tab.active::after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100%;
        height: 3px;
        background-color: var(--white);
        animation: slideIn 0.3s ease;
      }

      .form-container {
        padding: 0 2rem 2rem;
      }

      .form {
        display: none;
      }

      .form.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      .input-group {
        margin-bottom: 20px;
        position: relative;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .input-icon {
        position: absolute;
        left: 15px;
        top: 38px;
        color: var(--dark-pink);
        font-size: 1.2rem;
      }

      .input-field {
        width: 100%;
        padding: 15px 15px 15px 45px;
        border: none;
        border-radius: 50px;
        background-color: rgba(255, 255, 255, 0.9);
        color: var(--text-color);
        font-size: 1rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .input-field:focus {
        outline: none;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transform: translateY(-2px);
      }

      .password-toggle {
        position: absolute;
        right: 15px;
        top: 38px;
        color: var(--dark-pink);
        font-size: 1.2rem;
        cursor: pointer;
      }

      .submit-btn {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 50px;
        background-color: var(--white);
        color: var(--primary-color);
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
        margin-top: 10px;
      }

      .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .submit-btn:active {
        transform: translateY(1px);
      }

      .submit-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.4),
          transparent
        );
        transition: 0.5s;
      }

      .submit-btn:hover::before {
        left: 100%;
      }

      .form-footer {
        text-align: center;
        margin-top: 30px;
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .form-link {
        color: var(--white);
        text-decoration: underline;
        cursor: pointer;
        font-weight: 500;
      }

      .form-link:hover {
        opacity: 0.8;
      }

      .social-login {
        margin-top: 25px;
        text-align: center;
      }

      .social-text {
        margin-bottom: 15px;
        font-size: 0.9rem;
        position: relative;
      }

      .social-text::before,
      .social-text::after {
        content: "";
        position: absolute;
        top: 50%;
        width: 30%;
        height: 1px;
        background-color: rgba(255, 255, 255, 0.5);
      }

      .social-text::before {
        left: 0;
      }

      .social-text::after {
        right: 0;
      }

      .social-icons {
        display: flex;
        justify-content: center;
        gap: 15px;
      }

      .social-icon {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background-color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .social-icon:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .social-icon.facebook {
        color: #4267b2;
      }

      .social-icon.google {
        color: #db4437;
      }

      .social-icon.twitter {
        color: #1da1f2;
      }

      .message {
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        font-size: 0.9rem;
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .error {
        background-color: rgba(231, 76, 60, 0.2);
        color: var(--error-color);
      }

      .success {
        background-color: rgba(46, 204, 113, 0.2);
        color: var(--success-color);
      }

      .loader {
        display: none;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--white);
        animation: spin 1s ease-in-out infinite;
        margin-left: 10px;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        from {
          width: 0;
        }
        to {
          width: 100%;
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes float {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(-100vh) rotate(360deg);
          opacity: 0;
        }
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 480px) {
        .container {
          width: 95%;
        }

        .logo-text {
          font-size: 2rem;
        }

        .logo-img {
          width: 40px;
          height: 40px;
        }

        .tab {
          font-size: 1rem;
        }

        .input-field {
          padding: 12px 12px 12px 40px;
        }

        .submit-btn {
          padding: 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="hearts" id="hearts"></div>

    <div class="container">
      <div class="logo-container">
        <img
          src="https://cdn-icons-png.flaticon.com/128/176/176670.png"
          alt="Love U Logo"
          class="logo-img"
        />
        <h1 class="logo-text">Love U</h1>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="login">Login</div>
        <div class="tab" data-tab="signup">Sign Up</div>
      </div>

      <div class="form-container">
        <div id="message" class="message"></div>

        <!-- Login Form -->
        <form id="loginForm" class="form active">
          <div class="input-group">
            <label for="loginEmail">Email</label>
            <i class="input-icon fas fa-envelope"></i>
            <input
              type="email"
              id="loginEmail"
              class="input-field"
              placeholder="Enter your email"
              required
            />
          </div>
          <div class="input-group">
            <label for="loginPassword">Password</label>
            <i class="input-icon fas fa-lock"></i>
            <input
              type="password"
              id="loginPassword"
              class="input-field"
              placeholder="Enter your password"
              required
            />
            <i
              class="password-toggle fas fa-eye-slash"
              id="loginPasswordToggle"
            ></i>
          </div>
          <button type="submit" class="submit-btn">
            Login
            <span class="loader" id="loginLoader"></span>
          </button>
          <div class="form-footer">
            <p>
              Forgot your password?
              <span class="form-link" id="resetPassword">Reset it</span>
            </p>
          </div>

          <div class="social-login">
            <p class="social-text">Or login with</p>
            <div class="social-icons">
              <div class="social-icon facebook" id="facebookLogin">
                <i class="fab fa-facebook-f"></i>
              </div>
              <div class="social-icon google" id="googleLogin">
                <i class="fab fa-google"></i>
              </div>
              <div class="social-icon twitter" id="twitterLogin">
                <i class="fab fa-twitter"></i>
              </div>
            </div>
          </div>
        </form>

        <!-- Sign Up Form -->
        <form id="signupForm" class="form">
          <div class="input-group">
            <label for="signupUsername">Username</label>
            <i class="input-icon fas fa-user"></i>
            <input
              type="text"
              id="signupUsername"
              class="input-field"
              placeholder="Choose a username"
              required
            />
          </div>
          <div class="input-group">
            <label for="signupEmail">Email</label>
            <i class="input-icon fas fa-envelope"></i>
            <input
              type="email"
              id="signupEmail"
              class="input-field"
              placeholder="Enter your email"
              required
            />
          </div>
          <div class="input-group">
            <label for="signupPassword">Password</label>
            <i class="input-icon fas fa-lock"></i>
            <input
              type="password"
              id="signupPassword"
              class="input-field"
              placeholder="Create a password"
              required
            />
            <i
              class="password-toggle fas fa-eye-slash"
              id="signupPasswordToggle"
            ></i>
          </div>
          <div class="input-group">
            <label for="confirmPassword">Confirm Password</label>
            <i class="input-icon fas fa-lock"></i>
            <input
              type="password"
              id="confirmPassword"
              class="input-field"
              placeholder="Confirm your password"
              required
            />
            <i
              class="password-toggle fas fa-eye-slash"
              id="confirmPasswordToggle"
            ></i>
          </div>
          <button type="submit" class="submit-btn">
            Sign Up
            <span class="loader" id="signupLoader"></span>
          </button>
          <div class="form-footer">
            <p>
              By signing up, you agree to our
              <span class="form-link">Terms</span> and
              <span class="form-link">Privacy Policy</span>
            </p>
          </div>
        </form>
      </div>
    </div>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDJP2XIR51qGTLINiKvEoscYTMt11CaZ5s",
        authDomain: "paytrust-71e30.firebaseapp.com",
        databaseURL: "https://paytrust-71e30-default-rtdb.firebaseio.com/",
        projectId: "paytrust-71e30",
        storageBucket: "paytrust-71e30.appspot.com",
        messagingSenderId: "492609516838",
        appId: "1:492609516838:android:5a924ad3b7e8e508fa3de7",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const database = firebase.database();

      // Create floating hearts
      function createHearts() {
        const heartsContainer = document.getElementById("hearts");
        const heartCount = 15;

        for (let i = 0; i < heartCount; i++) {
          const heart = document.createElement("div");
          heart.className = "heart";
          heart.innerHTML = "❤️";
          heart.style.left = Math.random() * 100 + "vw";
          heart.style.top = Math.random() * 100 + "vh";
          heart.style.animationDuration = 3 + Math.random() * 7 + "s";
          heart.style.animationDelay = Math.random() * 5 + "s";
          heartsContainer.appendChild(heart);
        }
      }

      // Tab switching functionality
      const tabs = document.querySelectorAll(".tab");
      const forms = document.querySelectorAll(".form");

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          const target = tab.dataset.tab;

          // Update active tab
          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          // Update active form
          forms.forEach((form) => {
            form.classList.remove("active");
            if (form.id === `${target}Form`) {
              form.classList.add("active");
            }
          });

          // Clear message
          document.getElementById("message").style.display = "none";
        });
      });

      // Password toggle functionality
      const togglePasswordVisibility = (passwordInput, toggleIcon) => {
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          toggleIcon.classList.replace("fa-eye-slash", "fa-eye");
        } else {
          passwordInput.type = "password";
          toggleIcon.classList.replace("fa-eye", "fa-eye-slash");
        }
      };

      document
        .getElementById("loginPasswordToggle")
        .addEventListener("click", function () {
          togglePasswordVisibility(
            document.getElementById("loginPassword"),
            this
          );
        });

      document
        .getElementById("signupPasswordToggle")
        .addEventListener("click", function () {
          togglePasswordVisibility(
            document.getElementById("signupPassword"),
            this
          );
        });

      document
        .getElementById("confirmPasswordToggle")
        .addEventListener("click", function () {
          togglePasswordVisibility(
            document.getElementById("confirmPassword"),
            this
          );
        });

      // Message display function
      function showMessage(message, type) {
        const messageElement = document.getElementById("message");
        messageElement.textContent = message;
        messageElement.className = `message ${type}`;
        messageElement.style.display = "block";

        // Auto-hide message after 5 seconds
        setTimeout(() => {
          messageElement.style.display = "none";
        }, 5000);
      }

      // Login form submit
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const email = document.getElementById("loginEmail").value;
          const password = document.getElementById("loginPassword").value;
          const loader = document.getElementById("loginLoader");

          // Show loader
          loader.style.display = "inline-block";

          // Sign in with Firebase Auth
          auth
            .signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
              // Success
              showMessage("Login successful! Redirecting...", "success");

              // Redirect to main page after a short delay
              setTimeout(() => {
                window.location.href = "main.html"; // Redirect to your main page
              }, 1500);
            })
            .catch((error) => {
              // Error handling
              let errorMessage;
              switch (error.code) {
                case "auth/user-not-found":
                  errorMessage = "No account found with this email address.";
                  break;
                case "auth/wrong-password":
                  errorMessage = "Incorrect password. Please try again.";
                  break;
                case "auth/invalid-email":
                  errorMessage = "Invalid email address format.";
                  break;
                default:
                  errorMessage = `Login failed: ${error.message}`;
              }
              showMessage(errorMessage, "error");
            })
            .finally(() => {
              // Hide loader
              loader.style.display = "none";
            });
        });

      // Sign up form submit - Updated implementation
      document
        .getElementById("signupForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const username = document.getElementById("signupUsername").value;
          const email = document.getElementById("signupEmail").value;
          const password = document.getElementById("signupPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;
          const loader = document.getElementById("signupLoader");

          // Validate passwords match
          if (password !== confirmPassword) {
            showMessage("Passwords do not match!", "error");
            return;
          }

          // Validate input fields
          if (!username || !email || !password) {
            showMessage("All fields are required", "error");
            return;
          }

          // Show loader
          loader.style.display = "inline-block";

          // Create user with Firebase Auth
          auth
            .createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
              const user = userCredential.user;

              // Prepare comprehensive user data object
              const userData = {
                personalInfo: {
                  username: username,
                  email: email,
                  profileImageUrl: "", // Can be updated later
                  phoneNumber: "", // Can be updated in settings
                },
                accountInfo: {
                  userbalance: 0,
                  tokens: 20,
                  verified: false,
                },
                settings: {
                  darkMode: false,
                  notifications: true,
                  themeColor: "pink",
                },
                metadata: {
                  createdAt: firebase.database.ServerValue.TIMESTAMP,
                  lastLogin: firebase.database.ServerValue.TIMESTAMP,
                  accountStatus: "active",
                },
              };

              // Create a reference to the user's data location
              // Using the same path structure as auth.html
              const userRef = database.ref("loveu/users/" + user.uid);

              // Set the user data in the database
              return userRef.set(userData);
            })
            .then(() => {
              showMessage(
                "Account created successfully! You can now log in.",
                "success"
              );

              // Clear form
              document.getElementById("signupForm").reset();

              // Switch to login tab
              document.querySelector('.tab[data-tab="login"]').click();
            })
            .catch((error) => {
              console.error("Error during registration:", error);
              // Error handling
              let errorMessage;
              switch (error.code) {
                case "auth/email-already-in-use":
                  errorMessage = "This email is already registered.";
                  break;
                case "auth/invalid-email":
                  errorMessage = "Invalid email address format.";
                  break;
                case "auth/weak-password":
                  errorMessage =
                    "Password is too weak. Use at least 6 characters.";
                  break;
                default:
                  errorMessage = `Registration failed: ${error.message}`;
              }
              showMessage(errorMessage, "error");
            })
            .finally(() => {
              // Hide loader
              loader.style.display = "none";
            });
        });

      // Password reset functionality
      document
        .getElementById("resetPassword")
        .addEventListener("click", function () {
          const email = document.getElementById("loginEmail").value;

          if (!email) {
            showMessage("Please enter your email address first.", "error");
            return;
          }

          auth
            .sendPasswordResetEmail(email)
            .then(() => {
              showMessage(
                "Password reset email sent. Check your inbox.",
                "success"
              );
            })
            .catch((error) => {
              showMessage(
                `Failed to send reset email: ${error.message}`,
                "error"
              );
            });
        });

      // Social login buttons
      document
        .getElementById("googleLogin")
        .addEventListener("click", function () {
          const provider = new firebase.auth.GoogleAuthProvider();
          socialLogin(provider);
        });

      document
        .getElementById("facebookLogin")
        .addEventListener("click", function () {
          const provider = new firebase.auth.FacebookAuthProvider();
          socialLogin(provider);
        });

      document
        .getElementById("twitterLogin")
        .addEventListener("click", function () {
          const provider = new firebase.auth.TwitterAuthProvider();
          socialLogin(provider);
        });

      function socialLogin(provider) {
        auth
          .signInWithPopup(provider)
          .then((result) => {
            const user = result.user;

            // Check if user already exists in database
            return database
              .ref("loveu/users/" + user.uid)
              .once("value")
              .then((snapshot) => {
                if (!snapshot.exists()) {
                  // Create new user data
                  const userData = {
                    personalInfo: {
                      username: user.displayName || user.email.split("@")[0],
                      email: user.email,
                      profileImageUrl: user.photoURL || "",
                      phoneNumber: user.phoneNumber || "",
                    },
                    accountInfo: {
                      userbalance: 0,
                      tokens: 30,
                      verified: user.emailVerified,
                      followers: 0,
                    },
                    settings: {
                      darkMode: false,
                      notifications: true,
                      themeColor: "pink",
                    },
                    metadata: {
                      createdAt: firebase.database.ServerValue.TIMESTAMP,
                      lastLogin: firebase.database.ServerValue.TIMESTAMP,
                      accountStatus: "active",
                    },
                  };

                  // Save to database
                  return database.ref("loveu/users/" + user.uid).set(userData);
                }
                return Promise.resolve();
              });
          })
          .then(() => {
            showMessage("Login successful! Redirecting...", "success");

            // Redirect to main page after a short delay
            setTimeout(() => {
              window.location.href = "main.html"; // Redirect to your main page
            }, 1500);
          })
          .catch((error) => {
            console.error("Social login error:", error);
            showMessage(`Social login failed: ${error.message}`, "error");
          });
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        createHearts();

        // Check if user is already logged in
        auth.onAuthStateChanged(function (user) {
          if (user) {
            // Update last login time
            database
              .ref(`loveu/users/${user.uid}/metadata/lastLogin`)
              .set(firebase.database.ServerValue.TIMESTAMP)
              .then(() => {
                // User is signed in, redirect to main page
                window.location.href = "main.html";
              })
              .catch((error) => {
                console.error("Error updating last login:", error);
                // Still redirect even if update fails
                window.location.href = "main.html";
              });
          }
        });
      });
    </script>
  </body>
</html>
